<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dao.AccountDAO">
	<resultMap id="accountMap" type="account">
		<result column="SORT_NO" property="sortNo" />
		<result column="USER_NO" property="userNo" />
		<result column="NAME" property="categoryName" />
		<result column="CATEGORY_NO" property="categoryNo" />
		<result column="TRAN_DATE" property="tranDate" />
		<result column="PAYMENT" property="payment" />
		<result column="DESCRIPTION" property="description" />
		<result column="NOTE" property="note" />
		<result column="AMOUNT" property="amount" />
	</resultMap>
	
	<!-- 최근 10개 거래조회 -->
	<!-- 
	<select id="selectRecentAccount" resultMap="accountMap" parameterType="int">
	</select>
	 -->
	
	<select id="selectRecentAccount" parameterType="int" resultMap="accountMap">
		select *
		from(
			select account.*, catagory.name		
			  from MINIHOMPY_ACCOUNT account
			  	   , minihompy_category catagory
			 where USER_NO = #{USER_NO}
			   and account.category_no = catagory.category_no	
		  order by TRAN_DATE desc
			)
		where ROWNUM <![CDATA[<=]]> 10
	</select>
	
	<!-- 거래 추가 -->
	<insert id="insertAccount" parameterType="account">
	    <selectKey keyProperty="sortNo" order="BEFORE" resultType="int">
	        select sequence s_minihompy_account_sort_no.nextVal from dual
	    </selectKey>
	    insert into MINIHOMPY_ACCOUNT(SORT_NO, USER_NO, CATEGORY_NO, TRAN_DATE
	    								, PAYMENT, DESCRIPTION, NOTE, AMOUNT) 
	    values (#{sortNo}, #{userNo}, #{categoryNo}, #{conttranDate}
	    		, #{payment}, #{description}, #{note}, #{amount})                               
	</insert>
	
	<!-- 거래 수정 -->
	<update id="updateAccount" parameterType="account">
		update MINIHOMPY_ACCOUNT
		   set
		   	   CATEGORY_NO = #{categoryNo},
			   TRAN_DATE = #{tranDate}
		   	   PAYMENT = #{payment},
			   DESCRIPTION = #{description}
		   	   NOTE = #{note},		   	   
			   AMOUNT = #{amount}
		 where sort_no = #{sortNo}
	</update>
	
	<!-- 거래 삭제 -->
	<delete id="deleteAccount" parameterType="int">
		delete from MINIHOMPY_ACCOUNT
		where sort_no = #{sortNo}
	</delete>
	<!-- ############################################################# -->

</mapper>